/*
 * main.c
 *
 *  Created on: 2024. 11. 30.
 *      Author: foodbug
 */
#include "xil_io.h"
#include "stdio.h"
#include "xparameters.h"
#include "mymaxsonar.h"

// Delay 함수: 간단한 루프를 사용한 딜레이
void Delay(unsigned int n)
{
    volatile unsigned int i;
    for (i = 0; i < n; i++);
}

int main()
{
    unsigned int pwm_status, pulse_width, distance;

    while (1) {
        // PWM 상태 읽기
        pwm_status = MYMAXSONAR_mReadReg(XPAR_MYMAXSONAR_0_S00_AXI_BASEADDR, 0); // PWM 현재 상태
        // 펄스 길이 읽기
        pulse_width = MYMAXSONAR_mReadReg(XPAR_MYMAXSONAR_0_S00_AXI_BASEADDR, 4); // 펄스 길이
        // 거리 계산 (하드웨어에서 계산된 거리 값 읽기)
        distance = MYMAXSONAR_mReadReg(XPAR_MYMAXSONAR_0_S00_AXI_BASEADDR, 8); // 거리 값

        // 읽은 데이터 출력
        printf("PWM Status: 0x%x, Pulse Width: %u, Distance: %u inches\n", pwm_status, pulse_width, distance);

        // 딜레이
        Delay(20000);
    }

    return 0;
}
